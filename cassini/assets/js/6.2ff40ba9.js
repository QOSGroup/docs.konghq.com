(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{165:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h3",{attrs:{id:"中继约定"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中继约定","aria-hidden":"true"}},[s._v("#")]),s._v(" 中继约定")]),s._v(" "),a("p",[s._v("版本:\nv0.1")]),s._v(" "),a("p",[s._v("日期:\n2018年10月16日")]),s._v(" "),a("p",[s._v("目录\n[TOC]")]),s._v(" "),a("h3",{attrs:{id:"简介："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介：","aria-hidden":"true"}},[s._v("#")]),s._v(" 简介：")]),s._v(" "),a("p",[s._v("QCP跨链协议中中继（Cassini）作为链之间连接的纽带，使跨链交易能够完成。前提是中继和链需要符合本文的约定。")]),s._v(" "),a("h3",{attrs:{id:"体系结构："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#体系结构：","aria-hidden":"true"}},[s._v("#")]),s._v(" 体系结构：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://github.com/QOSGroup/static/blob/master/cassini.jpg?raw=true",alt:"framework"}})]),s._v(" "),a("ul",[a("li",[s._v("BlockchainA和BlockchainB连接共同的中继Cassini；")]),s._v(" "),a("li",[s._v("Cassini订阅链上跨链交易事件，获取交易摘要，进行2/3共识，随机找一个诚实节点获取跨链交易；")]),s._v(" "),a("li",[s._v("当BlockchainA新块内有跨链交易，将跨链交易放入outbox,并按顺序递增编号，当前最大编号叫sequcnce。区块链保证该编号的连续性；")]),s._v(" "),a("li",[s._v("BlockchainB将通过Cassini收到的交易存入inbox；")]),s._v(" "),a("li",[s._v("Cassini查询BlockchainB inbox 的sequence 记作seq1,中继顺序取BlockchainA 的 outbox 的编号大于seq1的交易，一次可以取一条或多条；")]),s._v(" "),a("li",[s._v("Cassini对交易进行验签，2/3共识等处理后路由到目标链；")]),s._v(" "),a("li",[s._v("Cassini具有多实例协同并行处理的能力。")])]),s._v(" "),a("h3",{attrs:{id:"事件发布订阅-交易查询与处理："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件发布订阅-交易查询与处理：","aria-hidden":"true"}},[s._v("#")]),s._v(" 事件发布订阅,交易查询与处理：")]),s._v(" "),a("ul",[a("li",[s._v("1、\tCassini通过websocket 订阅链上跨链event。过滤条件为 “tm.event = 'Tx' AND qcp.to = 'xxx'”；")]),s._v(" "),a("li",[s._v("2、\t链将跨链的交易在结构体 ResponseDeliverTx成员变量Tags中增加值对 “qcp.to = 'xxx'“ 。XXX表示目标链的名称；")]),s._v(" "),a("li",[s._v("3、\tCassini收到事件后，会进行2/3 的共识校验；")]),s._v(" "),a("li",[s._v("4、\t通过2/3 共识校验后，Cassini会进一步调用restful API（ABCI Query）查询交易数据；")]),s._v(" "),a("li",[s._v("5、\tCassini查询到交易数据，会通过调用restful API（ABCI BroadcastTxAsync 或ABCI BroadcastTxSync）向目标链提交交易，完成交易的处理；")]),s._v(" "),a("li",[s._v("6、\t跨链交易结果返回过程同1,2,3,4,5步。")])]),s._v(" "),a("h3",{attrs:{id:"event数据结构："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#event数据结构：","aria-hidden":"true"}},[s._v("#")]),s._v(" Event数据结构：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('EventDataTx{\n    Height\n    Index\n    Tx\n    Result.Data\n    Result.Tags    {\n        {"qcp.from":     string  }, //qsc name 或 qos\n        {"qcp.to":       string  }, //qsc name 或 qos\n        {"qcp.sequence": int64   },\n        {"qcp.hash":     []byte  },  //TxQcp 做 sha256\n    }\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"rest-service-api需求："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest-service-api需求：","aria-hidden":"true"}},[s._v("#")]),s._v(" Rest Service API需求：")]),s._v(" "),a("ul",[a("li",[s._v("get       取 outbox 最大sequence")]),s._v(" "),a("li",[s._v("get       取 inbox 最大sequence")]),s._v(" "),a("li",[s._v("get\t    取 outbox 中给定sequence编号的交易（TxQcp）")]),s._v(" "),a("li",[s._v("post\t    接收交易（TxQcp）")]),s._v(" "),a("li",[s._v("get\t    批量取 outbox 中给定sequence编号之后的交易（TxQcp）")]),s._v(" "),a("li",[s._v("post\t    批量接收交易（TxQcp）")])]),s._v(" "),a("h3",{attrs:{id:"rest-service-数据结构："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest-service-数据结构：","aria-hidden":"true"}},[s._v("#")]),s._v(" Rest Service 数据结构：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("type TxQcp struct {\n\tPayload  \t[]byte \t//交易体\n\tFrom     \tstring \t//源链ID\n\tTo       \tstring \t//目标链ID\n\tSequence \tint64\n\tIsResult \tbool   \t//是否为result\n\tHeight     \tint64   //块高度  \n\tSign     \t[]byte \t//对本交易的签名，公链不需要签名     \n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}],!1,null,null,null);n.options.__file="cassini.md";t.default=n.exports}}]);