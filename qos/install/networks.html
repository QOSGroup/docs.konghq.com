<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Networks | QOS</title>
    <meta name="description" content="Documentation for the QOS.">
    
    
    <link rel="preload" href="/qos/assets/css/0.styles.ba9dcb4a.css" as="style"><link rel="preload" href="/qos/assets/js/app.776a5d68.js" as="script"><link rel="preload" href="/qos/assets/js/11.0a2fe469.js" as="script"><link rel="prefetch" href="/qos/assets/js/10.a4f8c63f.js"><link rel="prefetch" href="/qos/assets/js/12.ebe06427.js"><link rel="prefetch" href="/qos/assets/js/13.492a9bff.js"><link rel="prefetch" href="/qos/assets/js/14.d479f408.js"><link rel="prefetch" href="/qos/assets/js/15.a0d73d00.js"><link rel="prefetch" href="/qos/assets/js/16.863561c6.js"><link rel="prefetch" href="/qos/assets/js/17.0209684b.js"><link rel="prefetch" href="/qos/assets/js/18.bb8b4497.js"><link rel="prefetch" href="/qos/assets/js/19.264faf69.js"><link rel="prefetch" href="/qos/assets/js/2.df56fc06.js"><link rel="prefetch" href="/qos/assets/js/20.d14a873d.js"><link rel="prefetch" href="/qos/assets/js/21.7ccfd1c6.js"><link rel="prefetch" href="/qos/assets/js/3.5d1eb553.js"><link rel="prefetch" href="/qos/assets/js/4.5e735f79.js"><link rel="prefetch" href="/qos/assets/js/5.65fac64d.js"><link rel="prefetch" href="/qos/assets/js/6.42735ae5.js"><link rel="prefetch" href="/qos/assets/js/7.22519c6e.js"><link rel="prefetch" href="/qos/assets/js/8.8f414997.js"><link rel="prefetch" href="/qos/assets/js/9.66942802.js">
    <link rel="stylesheet" href="/qos/assets/css/0.styles.ba9dcb4a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/qos/" class="home-link router-link-active"><!----> <span class="site-name">QOS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://www.github.com/QOSGroup/qos" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Back to QOS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://www.github.com/QOSGroup/qos" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Back to QOS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Introduction</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/qos/introduction/qos.html" class="sidebar-link">QOS</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/qos/install/installation.html" class="sidebar-link">Install</a></li><li><a href="/qos/install/networks.html" class="active sidebar-link">Networks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/qos/install/networks.html#single-node" class="sidebar-link">Single-node</a></li><li class="sidebar-sub-header"><a href="/qos/install/networks.html#cluster" class="sidebar-link">Cluster</a></li></ul></li><li><a href="/qos/install/testnet.html" class="sidebar-link">Testnet</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Client</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/qos/client/qoscli.html" class="sidebar-link">qoscli</a></li><li><a href="/qos/client/account.html" class="sidebar-link">account</a></li><li><a href="/qos/client/transfer.html" class="sidebar-link">transfer</a></li><li><a href="/qos/client/approve.html" class="sidebar-link">approve</a></li><li><a href="/qos/client/qsc.html" class="sidebar-link">qsc</a></li><li><a href="/qos/client/qcp.html" class="sidebar-link">qcp</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Spec</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/qos/spec/account.html" class="sidebar-link">Account</a></li><li><a href="/qos/spec/genesis.html" class="sidebar-link">Genesis</a></li><li><a href="/qos/spec/txs/transfer.html" class="sidebar-link">Transfer</a></li><li><a href="/qos/spec/txs/approve.html" class="sidebar-link">Approve</a></li><li><a href="/qos/spec/txs/qsc.html" class="sidebar-link">QSC</a></li><li><a href="/qos/spec/txs/qcp.html" class="sidebar-link">QCP</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="networks"><a href="#networks" aria-hidden="true" class="header-anchor">#</a> Networks</h1> <h2 id="single-node"><a href="#single-node" aria-hidden="true" class="header-anchor">#</a> Single-node</h2> <ul><li>init</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>qosd init --chain-id=qos-test
{
  &quot;chain_id&quot;: &quot;qos-test&quot;,
  &quot;node_id&quot;: &quot;1c3100c28a44f1facf45aa83e9aa3d8ff8ac6b1f&quot;,
  &quot;app_message&quot;: &quot;null&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>注意init 可添加--home flag指定配置文件地址，默认在$HOME/.qosd
<code>init</code>操作后,通过执行<code>qosd add-genesis-validator</code>添加validator</p> <ul><li>add-genesis-accounts</li></ul> <p>使用<code>qosd add-genesis-accounts</code>初始化account账户到配置文件中.</p> <blockquote><p>使用<code>qoscli keys add</code>创建account账户</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>
$ qoscli keys add qosInitAcc
Enter a passphrase for your key:
Repeat the passphrase:

$ qoscli keys list

NAME:   TYPE:   ADDRESS:                                                PUBKEY:
qosInitAcc      local   address1lly0audg7yem8jt77x2jc6wtrh7v96hgve8fh8  4MFA7MtUl1+Ak3WBtyKxGKvpcu4e5ky5TfAC26cN+mQ=

# 初始化账户
$ qosd add-genesis-accounts address1lly0audg7yem8jt77x2jc6wtrh7v96hgve8fh8,1000000qos

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>config-root-ca</li></ul> <p>使用<code>qosd config-root-ca</code>初始化root CA公钥到配置文件.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Config root CA

Usage:
  qosd config-root-ca [root.pub] [flags]

Flags:
  -h, --help   help for config-root-ca

Global Flags:
      --home string        directory for config and data (default &quot;/home/imuge/.qosd&quot;)
      --log_level string   Log level (default &quot;main:info,state:info,*:error&quot;)
      --trace              print out full stack trace on errors
      
# 设置roort CA
$ qosd config-root-ca root.pub
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>查看genesis.json内容，确认配置成功。</p> <ul><li>add-genesis-validator</li></ul> <p>使用<code>qosd add-genesis-validator</code>初始化validator到配置文件中.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>
$ qosd add-genesis-validator -h

Add genesis validator to genesis.json

Usage:
  qosd add-genesis-validator [flags]

Flags:
      --consPubkey string   validator's ed25519 consPubkey
  -h, --help                help for add-genesis-validator
      --operator string     operator address
      --power int           validator's voting power. default is 10 (default 10)

# 使用上面的初始化账户地址作为operator
$ qosd add-genesis-validator --operator address1lly0audg7yem8jt77x2jc6wtrh7v96hgve8fh8


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>start</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd start --with-tendermint
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果一切正常，会看到控制台输出打块信息</p> <h2 id="cluster"><a href="#cluster" aria-hidden="true" class="header-anchor">#</a> Cluster</h2> <p>四个Validator节点为例</p> <h3 id="单台机器"><a href="#单台机器" aria-hidden="true" class="header-anchor">#</a> 单台机器</h3> <ul><li>init</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ cd &amp;&amp; mkdir node{1..4}
$ for i in {1..4}; do qosd init --chain-id=qos-test --name=node${i} --home=$HOME/node${i}; done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>添加创世账户</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qoscli keys add qosgenesisacc
Enter a passphrase for your key:
Repeat the passphrase:

$ qoscli keys  list
NAME:	TYPE:	ADDRESS:						PUBKEY:
qosgenesisacc	local	address1rh47fd6ykkj0kpkukkt9pskgppfl30lpv9n9pu	EnChknIClMgiwcqCKjIraYZdK4+wTaATAfp4GUNUIAo=


$ for i in {1..4}; do qosd add-genesis-account --addr $(qoscli keys  list | grep qosgenesisacc | awk '{print $3}')  --coins 100000qos,1000000qstar --home=$HOME/node${i}; done

//查看genesis.json配置
$ cat $HOME/node1/config/genesis.json

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>配置validators</li></ul> <p>查看每个节点的validator 配置文件:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>//node1
$ cat $HOME/node1/config/priv_validator.json

//node2
$ cat $HOME/node2/config/priv_validator.json

//node3
$ cat $HOME/node3/config/priv_validator.json

//node4
$ cat $HOME/node4/config/priv_validator.json

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>使用<code>qosd add-genesis-validator</code>命令将每个节点的<code>validator</code>添加至<code>genesis.json</code>配置文件中</p> <p><strong>添加<code>validator</code>需要指定操作者<code>operator</code>,可以通过<code>qoscli keys add</code>分别添加操作者<code>operator</code></strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qoscli keys add node1oper
$ qoscli keys add node2oper
$ qoscli keys add node3oper
$ qoscli keys add node4oper
$ qoscli keys list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>以下示例中使用创世账户<code>qosgenesisacc</code>作为4个节点<code>validator</code>的<code>operator</code>,也可以为节点指定不同的<code>operator</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ export node1pk=$(sed -n '/PubKey/,/value/p' $HOME/node1/config/priv_validator.json|sed 1d|awk -F\&quot; '{print $4}')

$ export node2pk=$(sed -n '/PubKey/,/value/p' $HOME/node2/config/priv_validator.json|sed 1d|awk -F\&quot; '{print $4}')

$ export node3pk=$(sed -n '/PubKey/,/value/p' $HOME/node3/config/priv_validator.json|sed 1d|awk -F\&quot; '{print $4}')

$ export node4pk=$(sed -n '/PubKey/,/value/p' $HOME/node4/config/priv_validator.json|sed 1d|awk -F\&quot; '{print $4}')

$ export operator=$(qoscli keys  list | grep qosgenesisacc | awk '{print $3}')

$ export node1id=$(qosd tendermint show-node-id --home=$HOME/node1)

#node1执行

$ for i in {1..4}; do qosd add-genesis-validator --home=$HOME/node1 --consPubkey $(eval echo '$'&quot;node&quot;${i}pk) --operator $operator --power 10;done

#将node1/config/genesis.json分别拷贝至其他节点config目录下
$ cp $HOME/node1/config/genesis.json $HOME/node2/config
$ cp $HOME/node1/config/genesis.json $HOME/node3/config
$ cp $HOME/node1/config/genesis.json $HOME/node4/config
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>查看node1 node id</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd tendermint show-node-id --home=$HOME/node1
51bc172321ff3ea3e82f133d5116f0c11ac905d8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>修改节点端口配置文件</li></ul> <p><code>config/config.toml</code>定义了节点启动时不同的监听端口. 如果节点在不同的机器上运行,则只需修改<code>persistent_peers</code>选项即可:</p> <p>主要修改端口配置选项如下</p> <ul><li>moniker = &quot;&quot;</li> <li>proxy_app = &quot;tcp://127.0.0.1:26658&quot;</li> <li>prof_laddr = &quot;localhost:6060&quot;</li> <li>[rpc] laddr = &quot;tcp://0.0.0.0:26657&quot;</li> <li>[p2p] laddr = &quot;tcp://0.0.0.0:26656&quot;</li> <li>[p2p] persistent_peers = &quot;&quot;</li> <li>prometheus_listen_addr = &quot;:26660&quot;</li></ul> <p>node1配置如下:</p> <ul><li>moniker = &quot;node1&quot;</li> <li>proxy_app = &quot;tcp://127.0.0.1:16658&quot;</li> <li>prof_laddr = &quot;localhost:6061&quot;</li> <li>[rpc] laddr = &quot;tcp://0.0.0.0:16657&quot;</li> <li>[p2p] laddr = &quot;tcp://0.0.0.0:16656&quot;</li> <li>[p2p] persistent_peers = &quot;&quot;</li> <li>prometheus_listen_addr = &quot;:16660&quot;</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sed -i -e s#' *moniker.*'#'moniker = &quot;node1&quot;'#g   \
         -e s#' *proxy_app.*'#'proxy_app = &quot;tcp://127.0.0.1:16658&quot;'#g \
         -e s#' *prof_laddr.*'#'prof_laddr = &quot;localhost:6061&quot;'#g  \
         -e '/rpc/,/p2p/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:16657&quot;#g'  \
         -e '/p2p/,/laddr/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:16656&quot;#g' \
         -e s#' *prometheus_listen_addr.*'#'prometheus_listen_addr = &quot;:16660&quot;'#g \
         $HOME/node1/config/config.toml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>node2配置如下:</p> <ul><li>moniker = &quot;node2&quot;</li> <li>proxy_app = &quot;tcp://127.0.0.1:26658&quot;</li> <li>prof_laddr = &quot;localhost:6062&quot;</li> <li>[rpc] laddr = &quot;tcp://0.0.0.0:26657&quot;</li> <li>[p2p] laddr = &quot;tcp://0.0.0.0:26656&quot;</li> <li>[p2p] persistent_peers = &quot;&quot;</li> <li>prometheus_listen_addr = &quot;:26660&quot;</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>

$ sed -i -e s#' *moniker.*'#'moniker = &quot;node2&quot;'#g   \
         -e s#' *proxy_app.*'#'proxy_app = &quot;tcp://127.0.0.1:26658&quot;'#g \
         -e s#' *prof_laddr.*'#'prof_laddr = &quot;localhost:6062&quot;'#g  \
         -e '/rpc/,/p2p/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:26657&quot;#g'  \
         -e '/p2p/,/laddr/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:26656&quot;#g' \
         -e /p2p/,/upnp/s#' *persistent_peers = .*'#&quot;persistent_peers = \&quot;${node1id}@127.0.0.1:16656\&quot;&quot;#g \
         -e s#' *prometheus_listen_addr.*'#'prometheus_listen_addr = &quot;:26660&quot;'#g \
         $HOME/node2/config/config.toml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>node3配置如下:</p> <ul><li>moniker = &quot;node3&quot;</li> <li>proxy_app = &quot;tcp://127.0.0.1:36658&quot;</li> <li>prof_laddr = &quot;localhost:6063&quot;</li> <li>[rpc] laddr = &quot;tcp://0.0.0.0:36657&quot;</li> <li>[p2p] laddr = &quot;tcp://0.0.0.0:36656&quot;</li> <li>[p2p] persistent_peers = &quot;&quot;</li> <li>prometheus_listen_addr = &quot;:36660&quot;</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sed -i -e s#' *moniker.*'#'moniker = &quot;node3&quot;'#g   \
         -e s#' *proxy_app.*'#'proxy_app = &quot;tcp://127.0.0.1:36658&quot;'#g \
         -e s#' *prof_laddr.*'#'prof_laddr = &quot;localhost:6063&quot;'#g  \
         -e '/rpc/,/p2p/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:36657&quot;#g'  \
         -e '/p2p/,/laddr/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:36656&quot;#g' \
         -e /p2p/,/upnp/s#' *persistent_peers = .*'#&quot;persistent_peers = \&quot;${node1id}@127.0.0.1:16656\&quot;&quot;#g \
         -e s#' *prometheus_listen_addr.*'#'prometheus_listen_addr = &quot;:36660&quot;'#g \
         $HOME/node3/config/config.toml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>node4配置如下:</p> <ul><li>moniker = &quot;node4&quot;</li> <li>proxy_app = &quot;tcp://127.0.0.1:46658&quot;</li> <li>prof_laddr = &quot;localhost:6064&quot;</li> <li>[rpc] laddr = &quot;tcp://0.0.0.0:46657&quot;</li> <li>[p2p] laddr = &quot;tcp://0.0.0.0:46656&quot;</li> <li>[p2p] persistent_peers = &quot;&quot;</li> <li>prometheus_listen_addr = &quot;:46660&quot;</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sed -i -e s#' *moniker.*'#'moniker = &quot;node4&quot;'#g   \
         -e s#' *proxy_app.*'#'proxy_app = &quot;tcp://127.0.0.1:46658&quot;'#g \
         -e s#' *prof_laddr.*'#'prof_laddr = &quot;localhost:6064&quot;'#g  \
         -e '/rpc/,/p2p/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:46657&quot;#g'  \
         -e '/p2p/,/laddr/s#^ *laddr = .*$#laddr = &quot;tcp://0.0.0.0:46656&quot;#g' \
         -e /p2p/,/upnp/s#' *persistent_peers = .*'#&quot;persistent_peers = \&quot;${node1id}@127.0.0.1:16656\&quot;&quot;#g \
         -e s#' *prometheus_listen_addr.*'#'prometheus_listen_addr = &quot;:46660&quot;'#g \
         $HOME/node4/config/config.toml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>start</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd start --with-tendermint --home=$HOME/node1
$ qosd start --with-tendermint --home=$HOME/node2
$ qosd start --with-tendermint --home=$HOME/node3
$ qosd start --with-tendermint --home=$HOME/node4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="四台机器"><a href="#四台机器" aria-hidden="true" class="header-anchor">#</a> 四台机器</h3> <p>第一台node1 IP为ip1</p> <ul><li>init</li></ul> <p>四台机器分别执行 init 命令,chain-id保持一致, name不同</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd init --chain-id=qos-test --name=node1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在node1上执行:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qoscli keys add genAcc

$ qoscli keys list
NAME:	TYPE:	ADDRESS:						PUBKEY:
genAcc	local	address17k688l8afk4t42dr4z5ay0cpke39we7kxm9pzk	c5UuUZ/REvHExIY/eDcQvdjxiapE+aVSd37DulaxwBU=

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在node1配置文件<code>genesis.json</code>中添加初始账户:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd add-genesis-account --addr $(qoscli keys  list | grep genAcc | awk '{print $3}')  --coins 100000qos,1000000qstar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在node1配置文件<code>genesis.json</code>中添加node1节点为validator:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd add-genesis-validator --operator $(qoscli keys  list | grep genAcc | awk '{print $3}')
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在node1配置文件<code>genesis.json</code>中分别添加其他节点为validator:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd add-genesis-validator --consPubkey $NODES_VALIDATOR_PUBKEY --operator $(qoscli keys  list | grep genAcc | awk '{print $3}')
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>将node1中<code>genesis.json</code>文件拷贝至其他节点的$HOME/.qosd/config目录下</p></li> <li><p>查看node1 node id<br>
在node1上运行：</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd tendermint show-node-id
b70c6ce13a11e14ee14bc793cbef835aa1b4b6bb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>修改node2配置</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ cd $HOME/.qosd/config
$ vi config.toml

# Comma separated list of nodes to keep persistent connections to
persistent_peers = &quot;b70c6ce13a11e14ee14bc793cbef835aa1b4b6bb@ip1:26656&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>修改node3配置</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ cd $HOME/.qosd/config
$ vi config.toml

# Comma separated list of nodes to keep persistent connections to
persistent_peers = &quot;b70c6ce13a11e14ee14bc793cbef835aa1b4b6bb@ip1:26656&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>修改node4配置</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ cd $HOME/.qosd/config
$ vi config.toml

# Comma separated list of nodes to keep persistent connections to
persistent_peers = &quot;b70c6ce13a11e14ee14bc793cbef835aa1b4b6bb@ip1:26656&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>start<br>
四台机器上分别执行</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd start --with-tendermint
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="testnet-cmd"><a href="#testnet-cmd" aria-hidden="true" class="header-anchor">#</a> testnet cmd</h3> <p>qosd testnet命令行工具，可批量生成集群配置文件，相关命令参考：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ qosd testnet --help
testnet will create &quot;v&quot; + &quot;n&quot; number of directories and populate each with
necessary files (private validator, genesis, config, etc.).

Note, strict routability for addresses is turned off in the config file.

Optionally, it will fill in persistent_peers list in config file using either hostnames or IPs.

Example:

	qosd testnet --chain-id=qostest --v=4 --o=./output --starting-ip-address=192.168.1.2 --genesis-accounts=address16lwp3kykkjdc2gdknpjy6u9uhfpa9q4vj78ytd,1000000qos,1000000qstars

Usage:
  qosd testnet [flags]

Flags:
      --chain-id string              Chain ID
      --genesis-accounts string      Add genesis accounts to genesis.json, eg: address16lwp3kykkjdc2gdknpjy6u9uhfpa9q4vj78ytd,1000000qos,1000000qstars. Multiple accounts separated by ';'
  -h, --help                         help for testnet
      --hostname-prefix string       Hostname prefix (node results in persistent peers list ID0@node0:26656, ID1@node1:26656, ...) (default &quot;node&quot;)
      --moniker string               Moniker
      --n int                        Number of non-validators to initialize the testnet with
      --node-dir-prefix string       Prefix the directory name for each node with (node results in node0, node1, ...) (default &quot;node&quot;)
      --o string                     Directory to store initialization data for the testnet (default &quot;./mytestnet&quot;)
      --p2p-port int                 P2P Port (default 26656)
      --populate-persistent-peers    Update config of each node with the list of persistent peers build using either hostname-prefix or starting-ip-address (default true)
      --root-ca string               Config root CA
      --starting-ip-address string   Starting IP address (192.168.0.1 results in persistent peers list ID0@192.168.0.1:26656, ID1@192.168.0.2:26656, ...)
      --v int                        Number of validators to initialize the testnet with (default 4)

Global Flags:
      --home string        directory for config and data (default &quot;/home/imuge/.qosd&quot;)
      --log_level string   Log level (default &quot;main:info,state:info,*:error&quot;)
      --trace              print out full stack trace on errors
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>app_state下validators列表中的operator与其cons_pubkey对应</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">12/14/2018, 8:28:40 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/qos/install/installation.html" class="prev">
          Install
        </a></span> <span class="next"><a href="/qos/install/testnet.html">
          Testnet
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/qos/assets/js/app.776a5d68.js" defer></script><script src="/qos/assets/js/11.0a2fe469.js" defer></script>
  </body>
</html>
